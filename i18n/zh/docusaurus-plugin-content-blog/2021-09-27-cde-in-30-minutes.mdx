---
slug: Build a CDE in 30 minutes
title: 在30分钟内建立一个CDE
author: Ansoni
author_title: 从头开始制作你自己的CDE!
author_url: https://github.com/agviegas
author_image_url: https://secure.gravatar.com/avatar/9263b9f81d351788e46bc64000c03cb6
tags:
  - 教程
  - CDE
  - 谷歌

---

<em>所有的大公司都在销售他们的CDE。你为什么不做你自己的CDE呢？</em>

<!--truncate-->

import { IfcImage } from "@site/src/components/Image/Image";
import { IfcCard } from "@site/src/components/Card/InfoCard";

<IfcImage hideSource={true} image={<img src={require("@site/static/img/blog/2021-09-27/lego.jpg").default} alt="Lego image"></img>} ifcLink="https://www.pexels.com/photo/set-of-multicolored-plastic-construction-toys-scattered-on-floor-7444982/" />

\##但是等等，什么是CDE？

📦非正式地讲，<strong>CDE</strong>只不过是一个集中了建筑项目信息的地方，可以通过互联网访问。

<IfcCard>🔧🔨CDEs可以拥有传统BIM应用的所有功能。3D查看器、阅读和编辑数据、能源模拟、自动测量和预算等。</IfcCard>️

然而，它们有一个基本的优势：它们是<strong>在网络上</strong>，这意味着它们可以从任何地方和任何设备上访问，而无需安装任何东西。

## 好的，但为什么我想要一个CDE？

💸 好吧，事实是，现在，CDE是新的黑色。<strong>业内几乎每家大公司都在建造CDE</strong>，并以高昂的价格出售给他们的客户。

🏃♀️🏃♂️🏃♀️随着互联网越来越快，越来越好，总有一天，我们所知道的桌面应用程序将失去意义，我们的大部分任务将在Web应用程序或服务器应用程序中执行。换句话说，<strong>CDE是未来的趋势</strong>，而现在有一场建立最佳<strong>CDE</strong>的大竞赛。

\##我明白了，CDEs很震撼。但我永远无法自己开发一个。

错了!你认为你不能做BIM解决方案的最大受益者是目前的BIM供应商。在IFC.js，我们想打破这个神话，从头开始做一个简单的CDE，以表明<strong>开始开发BIM应用并不难</strong>。

☝ 很明显，这个教程是一个最小的例子。但是从本教程的简单CDE到大公司的CDE，并没有想象中的那么多距离。<strong>闲话少说，让我们继续吧!</strong>

## CDE设计

\###战略

⏳ 我们只有<strong>半个小时</strong>的时间来做这个CDE，所以我们必须仔细选择如何做，以便不浪费任何时间。首先：我们需要<strong>一个地方来存储项目文件</strong>。你知道有什么现有的工具可以让我们这样做吗？我们已经想到了<strong>Google Drive</strong>!

<IfcCard>💪 Google Drive有很多功能：我们可以控制对文件的读写权限、版本控制、开放API......。简而言之，它有许多BIM软件公司向你收费的东西，但完全免费。</IfcCard>️

🛑 然而，Google Drive有一个基本的限制：它没有一个3D浏览器，也不允许轻易访问BIM模型（如IFC模型）中的数据。

<strong>🤝</strong>sは、ウェブ上で直接BIMアプリケーションを構築することを可能にします。GoogleドライブのストレージとパーミッションのパワーとIFC.jsの3Dとデータの読み込みと編集機能を組み合わせることで、30分で基本的なCDEを構築することができました。その方法を紹介します。

\###架构

🤷♀️<strong>如何连接</strong>IFC.js和google drive，以便能够将两者作为CDE使用？我们的设计方案如下。它可能看起来很复杂，但实际上非常非常简单。

<IfcImage image={<img src={require("@site/static/img/blog/2021-09-27/schema.jpg").default} alt="Schema explaining the concept of the CDE"></img>} />

🏠 首先，我们要创建一个能够<strong>从google drive下载文件的3D BIM网络应用</strong>。具体来说，它将从google drive下载它在URL参数中找到的ID的文件。例如，如果你的URL是<code>https://.../?id=123\&name=TEST.ifc</code>，它将从登录到应用程序的用户的谷歌账户中下载<code>ID</code>为<code>123</code>的文件。

然后，我们将创建一个<a href="https://developer.chrome.com/docs/extensions/">谷歌铬扩展</a>，它将做三件事。

*   <strong>读取</strong>用户通过网络搜刮点击的<strong>HTML元素的名称</strong>。

*   使用google drive API<strong>找出该元素的ID</strong>。

*   <strong>创建一个菜单，让用户用IFC.js网络应用程序打开URL</strong>。此外，你要添加两个URL参数：文件的名称和ID。

<IfcCard>简而言之：一个google chrome扩展在用户点击文件时获得文件的名称，并打开一个知道如何按其ID下载文件的网络应用。这就是全部。</IfcCard>️

### IFC.js应用程序

#### BIM应用程序

🏢多亏了IFC.js，<strong>这是最简单的部分</strong>。具体来说，我们要用<a href="https://github.com/IFCjs/web-ifc-viewer">web-ifc-viewer</a>来创建它，它可以在50行代码中制作BIM应用程序。你可以<a href="https://github.com/IFCjs/hello-world/tree/main/examples/web-ifc-viewer/google-drive-viewer">在这里</a>找到所有的代码。

😉 是的，你没看错：<strong>一个完整的3D BIM应用，只有50行</strong>。而且它包括剖面图和三维尺寸等功能。

```js
    import {IfcViewerAPI} from 'web-ifc-viewer';
    import {Color} from 'three'

    // Get div container where 3d scene is rendered
    const container = document.getElementById('viewer-container');

    // Initialize IFC.js API and add it as global variable
    const viewer = new IfcViewerAPI({
                            container,
                            backgroundColor: new Color(0xffffff)
                                });
    viewer.IFC.applyWebIfcConfig({
                            COORDINATE_TO_ORIGIN: true,
                            USE_FAST_BOOLS: true
                                });
    window.webIfcAPI = viewer;

    // Set up scene
    viewer.addAxes();
    viewer.addGrid(50, 50);
    viewer.IFC.setWasmPath('wasm/');
    viewer.clipper.active = true;
    let dimensionsActive = false;

    // Add basic input logic
    const handleKeyDown = (event) => {
        if (event.code === 'KeyE') {
            dimensionsActive = !dimensionsActive;
            viewer.dimensions.active = dimensionsActive;
            viewer.dimensions.previewActive = dimensionsActive;
            viewer.IFC.unPrepickIfcItems();
            window.onmousemove = dimensionsActive ?
                                            null :
                                .IFC.prePickIfcItem;
        }
        if (event.code === 'KeyD') {
            viewer.dimensions.create();
        }
        if (event.code === 'KeyG') {
            viewer.clipper.createPlane();
        }
        if (event.code === 'Delete') {
            viewer.dimensions.deleteAll();
            viewer.clipper.deletePlane();
            viewer.IFC.unpickIfcItems();
        }
    };
    window.onkeydown = handleKeyDown;

    // Highlight items when hovering over them
    window.onmousemove = viewer.IFC.prePickIfcItem;

    // Select items and log properties
    window.ondblclick = async () => {
        const item = await viewer.IFC.pickIfcItem(true);
        if(item.modelID === undefined || item.id === undefined ) return;
        console.log(
            await viewer.IFC.getProperties(item.modelID, item.id, true));
    }
```

🎨 确保你创建必要的HTML和CSS，让浏览者有你想要的外观和感觉。

#### Google Drive API

🔒🔒🔒嗯，我们有一个BIM浏览器，但目前它还不能从<strong>Google Drive API</strong>下载任何东西。不过，这很容易：只要按照<a href="https://developers.google.com/drive/api/v3/quickstart/js">官方文档</a>中的这些步骤，复制和粘贴JavaScript代码，就能访问API。

<IfcCard>🔑🔑🔑按照谷歌的指南，你需要创建一个新的谷歌云项目，以获得你自己的CLIENT\_ID和API\_KEY；它们只是你必须拥有的两个文本，以便谷歌知道你是谁。换句话说，你不能使用我们拥有的密钥来访问你的驱动器</IfcCard>️

📋 如果你看一下我们发布的代码，你会发现<strong>我们几乎复制和粘贴了</strong> <a href="https://developers.google.com/drive/api/v3/quickstart/js">谷歌例子</a>中的<strong>所有代码</strong>。我们唯一添加的是以下内容，它只是从网络应用程序的URL中获取文件的ID，并从google drive中下载它。

```js
/**
 *  Called when the signed in status changes, to update the UI
 *  appropriately. After a sign-in, the API is called.
 */
function updateSigninStatus(isSignedIn) {
  if (isSignedIn) {
    const { id, name } = getIdAndName();
    fileName.innerText = `Name: ${name}`;
    if (id) downloadFile(id);
    else console.log("No ID was providen as URL parameter!");
  }
}

/**
 *  Sign in the user upon button click.
 */
function handleAuthClick(event) {
  authorizeButton.onclick = handleSignoutClick;
  buttonText.innerText = "Sign out";
  gapi.auth2.getAuthInstance().signIn();
}

function downloadFile(fileId) {
  gapi.client.drive.files
    .get({
      fileId: fileId,
      alt: "media",
    })
    .then(
      function (response) {
        loadIfcModel(response.body);
      },
      function (error) {
        console.error(error);
      }
    );
}

function getIdAndName() {
  const urlParams = new URLSearchParams(window.location.search);
  const id = urlParams.get("id");
  const name = urlParams.get("name");
  return { id, name };
}

function loadIfcModel(text) {
  const blob = new Blob([text], { type: "text/plain" });
  const file = new File([blob], "ifcModel");
  window.webIfcAPI.IFC.loadIfc(file);
}
```

🎉 賀!你刚刚建立了一个能够从Google Drive下载文件的BIM应用程序。现在只剩下最后一个部分：创建谷歌浏览器扩展。

\#＃＃Chrome扩展

现在我们要做一个谷歌浏览器扩展，以便<strong>用户可以选择他们想打开的文件</strong>。如果你以前没有做过这个，可能听起来很吓人，但实际上非常简单。你可以<a href="https://github.com/IFCjs/hello-world/tree/main/examples/extensions/Drive-CDE">在这里</a>找到完成的结果。

<IfcCard>
  🔑🔑🔑按照谷歌的指南，你需要创建一个新的谷歌云项目，以获得你自己的CLIENT\_ID和API\KEY；它们只是你必须拥有的两个文本，以便谷歌知道你是谁。换句话说，你不能使用我们拥有的密钥来访问你的驱动器<a href="https://developers.google.com/drive/api/v3/about-sdk#create_and_open_files_directly_from_the_drive_ui">请看这里，了解更多细节</a>。
</IfcCard>

️

👣 互联网上有许多<a href="https://dev.to/anobjectisa/how-to-build-a-chrome-extension-new-manifest-v3-5edk">分步指南</a>，但我们建议你从我们的资源库中获取代码，研究它并玩玩它，看看它是如何工作的。

🧱 其实只有两个重要的文件。

*   <a href="https://github.com/IFCjs/hello-world/tree/main/examples/extensions/Drive-CDE/background.js">background.js</a>：控制页面的事件，比如用户点击什么，但不能访问页面内容。

*   <a href="https://github.com/IFCjs/hello-world/tree/main/examples/extensions/Drive-CDE/foreground.js">foreground.js</a>：可以访问页面内容，但不能访问事件。

👬 所以，你可以想象，这两个文件必须相互沟通，以达到我们的目的。正如你在代码中看到的，它们用一个简单的消息系统来做。

在资源库中，你会发现关于什么做什么的分步注释。总共只有不到100行的相关代码：其他都是复制和粘贴的。

### ＃＃＃都在一起!

🔥🔥这是我们的30分钟CDE的样子。

<iframe width="100%" height="600px" src="https://www.youtube.com/embed/lYzTaOBuv7k" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen />

## 结论

🏆 恭喜你！你刚刚创建了第一个CDE。你刚刚创建了<strong>你的第一个CDE</strong>。它可能看起来不多，但想想它的所有功能：文件存储、权限和版本控制、三维视图、访问属性、三维测量、剖面图......

🚀🚀🚀如果我们在这么短的时间内使用Google Drive做到了这一点，你能想象用IFC.js和其他技术（如<strong>数据库</strong>或<strong>服务器</strong>）构建的可能性有多大<strong>？</strong>别担心，我们将制作关于所有这些和更多内容的教程!
