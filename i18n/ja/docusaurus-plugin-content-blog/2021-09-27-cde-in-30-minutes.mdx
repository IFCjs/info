---
slug: Build a CDE in 30 minutes
title: 30分でCDEを構築
author: Ansoni
author_title: 自分だけのCDEをゼロから作ろう
author_url: https://github.com/agviegas
author_image_url: https://secure.gravatar.com/avatar/9263b9f81d351788e46bc64000c03cb6
tags:
  - チュートリアル
  - きょうつうデスクトップかんきょう
  - グーグル

---

<em>大企業がこぞってCDEを販売している。自分でCDEを作ったらどうですか？</em>

<!--truncate-->

import { IfcImage } from "@site/src/components/Image/Image";
import { IfcCard } from "@site/src/components/Card/InfoCard";

<IfcImage hideSource={true} image={<img src={require("@site/static/img/blog/2021-09-27/lego.jpg").default} alt="Lego image"></img>} ifcLink="https://www.pexels.com/photo/set-of-multicolored-plastic-construction-toys-scattered-on-floor-7444982/" />

## しかし、待ってください、CDEとは何ですか？

📦 簡単に言えば、<strong>CDEは</strong>建設プロジェクトの情報を一元化し、インターネットを通じてアクセスできる場所にほかならない。

<IfcCard>🔧 CDEは、従来のBIMアプリケーションのすべての機能性を持つことができます。3Dビューア、データの読み込みと編集、エネルギーシミュレーション、自動計測と予算など、従来のBIMアプリケーションの機能をすべて備えています。</IfcCard>️

しかし、基本的な利点は、<strong>ウェブ上にある</strong>ため、何もインストールしなくても、どこからでも、どのデバイスからでもアクセスできるということです。

## しかし、なぜCDEが必要なのでしょうか？

💸 実のところ、今、CDEは新しい黒です。<strong>業界のほぼすべての主要企業がCDEを構築</strong>し、法外な価格で顧客に販売しているのです。

インターネットがより速く、より良くなるにつれて、私たちが知っているデスクトップアプリケーションは関連性を失い、私たちのタスクの大部分はウェブアプリケーションまたはサーバーアプリケーションで実行される日が来るでしょう。つまり、<strong>CDEは未来の</strong>ものであり、現在、最高の<strong>CDEを</strong>構築するための大きな競争が行われているのです。

## CDEは素晴らしい。でも、自分で開発するのは無理です。

👩🏫間違い!BIMソリューションが出来ないと思っているあなたの最大の受益者は、現在のBIMベンダーです。IFC.jsでは、その神話を打ち破り、シンプルなCDEをゼロから作り、<strong>BIMアプリケーションの開発を始めることはそれほど難しくない</strong>ことを示したいと思いました。

☝ 言うまでもなく、このチュートリアルは最小限の例です。しかし、このチュートリアルの単純なCDEから大企業のCDEまでは、見た目ほど距離がありません。<strong>雑談はここまでにして、さっそく本題に入りましょう。</strong>

# CDEデザイン

### 戦略

このCDEを行う時間は<strong>30</strong>分しかないので、時間を無駄にしないために、慎重に方法を選択する必要があります⏳。まず最初に、<strong>プロジェクトのドキュメントを保存</strong>する場所が必要です。それを可能にする既存のツールをご存知ですか？私たちは、<strong>Googleドライブを</strong>思いつきました

<IfcCard>Google Driveは、ファイルへの読み取りと書き込みのアクセス制御、バージョン管理、オープンAPIなど、多くの機能を備えています。要するに、BIMソフトウェア会社が有料で提供しているものの多くを、完全に無料で提供しているのです。</IfcCard>️

しかし、Google Driveには3Dビューアーがなく、BIMモデル（IFCモデルなど）のデータに簡単にアクセスできないという根本的な制約があります😖。

<strong>IFC.j</strong>sは、ウェブ上で直接BIMアプリケーションを構築することを可能にします。GoogleドライブのストレージとパーミッションのパワーとIFC.jsの3Dとデータの読み込みと編集機能を組み合わせることで、30分で基本的なCDEを構築することができました。その方法を紹介します。

### アーキテクチャ

🤷♀️ IFC.jsとgoogle driveを<strong>連携</strong>させて、両方をCDEとして使えるようにするにはどうしたらいいでしょうか？私たちの設計案は以下の通りです。複雑そうに見えるかもしれませんが、実はとてもシンプルです。

<IfcImage image={<img src={require("@site/static/img/blog/2021-09-27/schema.jpg").default} alt="Schema explaining the concept of the CDE"></img>} />

🏠 まず、<strong>google driveからファイルをダウンロードできる3D BIMのWebアプリケーションを</strong>作成する予定です。具体的には、URLのパラメータにあるIDのgoogle driveからファイルをダウンロードします。例えば、URLが<code>https://.../?id=123\&name=TEST.ifc</code> の場合、アプリにログインしているユーザーのgoogleアカウントから<code>IDが</code> <code>123の</code>ファイルをダウンロードすることになります。

🌐 そして、3つのことを行う<a href="https://developer.chrome.com/docs/extensions/">グーグルクロームの拡張機能を</a>作成する予定です。

*   Webスクレイピングにより、ユーザーがクリックした<strong>HTML要素の名前を読み取る</strong>。

*   <strong>その要素のIDを</strong>google drive APIで調べる。

*   <strong>IFC.js の Web アプリケーションで URL を開くためのメニューを作成</strong>します。さらに、ファイルの名前とidという2つのurlパラメータを追加することになります。

<IfcCard>要するに、google chromeの拡張機能が、ユーザーがクリックするとファイル名を取得し、そのIDでファイルをダウンロードする方法を知っているウェブアプリを開く。それだけです。</IfcCard>️

### IFC.jsアプリ

#### BIMアプリ

🏢 IFC.jsのおかげで、ここが<strong>一番簡単</strong>です。具体的には、50行のコードでBIMアプリケーションを作ることができる<a href="https://github.com/IFCjs/web-ifc-viewer">web-ifc-viewerで</a>作成する予定です。すべてのコードは<a href="https://github.com/IFCjs/hello-world/tree/main/examples/web-ifc-viewer/google-drive-viewer">ここに</a>あります。

そうです、<strong>50行のフル3D BIMアプリ</strong>です。しかも、断面図や3D寸法などの機能も搭載しています。

```js
    import {IfcViewerAPI} from 'web-ifc-viewer';
    import {Color} from 'three'

    // Get div container where 3d scene is rendered
    const container = document.getElementById('viewer-container');

    // Initialize IFC.js API and add it as global variable
    const viewer = new IfcViewerAPI({
                            container,
                            backgroundColor: new Color(0xffffff)
                                });
    viewer.IFC.applyWebIfcConfig({
                            COORDINATE_TO_ORIGIN: true,
                            USE_FAST_BOOLS: true
                                });
    window.webIfcAPI = viewer;

    // Set up scene
    viewer.addAxes();
    viewer.addGrid(50, 50);
    viewer.IFC.setWasmPath('wasm/');
    viewer.clipper.active = true;
    let dimensionsActive = false;

    // Add basic input logic
    const handleKeyDown = (event) => {
        if (event.code === 'KeyE') {
            dimensionsActive = !dimensionsActive;
            viewer.dimensions.active = dimensionsActive;
            viewer.dimensions.previewActive = dimensionsActive;
            viewer.IFC.unPrepickIfcItems();
            window.onmousemove = dimensionsActive ?
                                            null :
                                .IFC.prePickIfcItem;
        }
        if (event.code === 'KeyD') {
            viewer.dimensions.create();
        }
        if (event.code === 'KeyG') {
            viewer.clipper.createPlane();
        }
        if (event.code === 'Delete') {
            viewer.dimensions.deleteAll();
            viewer.clipper.deletePlane();
            viewer.IFC.unpickIfcItems();
        }
    };
    window.onkeydown = handleKeyDown;

    // Highlight items when hovering over them
    window.onmousemove = viewer.IFC.prePickIfcItem;

    // Select items and log properties
    window.ondblclick = async () => {
        const item = await viewer.IFC.pickIfcItem(true);
        if(item.modelID === undefined || item.id === undefined ) return;
        console.log(
            await viewer.IFC.getProperties(item.modelID, item.id, true));
    }
```

🎨 必要なHTMLとCSSを作成して、視聴者が望む外観にする。

#### Google Drive API

BIMビューアーはありますが、今のところ<strong>Google Drive APIから</strong>何かをダウンロードすることはできません。しかし、それは簡単です。<a href="https://developers.google.com/drive/api/v3/quickstart/js">公式ドキュメントの</a>以下のステップに従い、APIにアクセスできるようにするためのJavaScriptコードをコピー＆ペーストするだけです。

<IfcCard>Googleのガイドに従って、新しいGoogle Cloudプロジェクトを作成し、あなた自身のCLIENT\_IDおよびAPI\_KEYを取得する必要があります; これらは、あなたが誰であるかを知るために持っていなければならない2つのテキストです。言い換えれば、私たちが持っているキーを使ってドライブにアクセスすることはできません。</IfcCard>️

📋 私たちが投稿したコードを見てみると、<a href="https://developers.google.com/drive/api/v3/quickstart/js">googleの例から</a> <strong>ほとんどすべてのコードをコピー＆ペーストして</strong>いることがわかります。追加したのは以下の部分のみで、単純にWebアプリケーションのURLからファイルのIDを取得してgoogle driveからダウンロードするようにしています。

```js
/**
 *  Called when the signed in status changes, to update the UI
 *  appropriately. After a sign-in, the API is called.
 */
function updateSigninStatus(isSignedIn) {
  if (isSignedIn) {
    const { id, name } = getIdAndName();
    fileName.innerText = `Name: ${name}`;
    if (id) downloadFile(id);
    else console.log("No ID was providen as URL parameter!");
  }
}

/**
 *  Sign in the user upon button click.
 */
function handleAuthClick(event) {
  authorizeButton.onclick = handleSignoutClick;
  buttonText.innerText = "Sign out";
  gapi.auth2.getAuthInstance().signIn();
}

function downloadFile(fileId) {
  gapi.client.drive.files
    .get({
      fileId: fileId,
      alt: "media",
    })
    .then(
      function (response) {
        loadIfcModel(response.body);
      },
      function (error) {
        console.error(error);
      }
    );
}

function getIdAndName() {
  const urlParams = new URLSearchParams(window.location.search);
  const id = urlParams.get("id");
  const name = urlParams.get("name");
  return { id, name };
}

function loadIfcModel(text) {
  const blob = new Blob([text], { type: "text/plain" });
  const file = new File([blob], "ifcModel");
  window.webIfcAPI.IFC.loadIfc(file);
}
```

🎉🎉 おめでとうございます。Google DriveからファイルをダウンロードできるBIMアプリケーションを構築しました。あとは、Google Chromeの拡張機能を作成するのみです。

### クロームエクステンション

さて、これからGoogle Chromeの拡張機能を作って、<strong>ユーザーが開きたい</strong>ファイルを選択できるようにします。初めてだと難しく感じるかもしれませんが、実はとても簡単なんです。出来上がったものは<a href="https://github.com/IFCjs/hello-world/tree/main/examples/extensions/Drive-CDE">こちらで</a>ご覧いただけます。

<IfcCard>
  Googleのガイドに従って、新しいGoogle Cloudプロジェクトを作成し、CLIENT\_IDおよびAPI\_KEYを取得する必要があります; これらは、Googleがあなたを知るために必要な2つのテキストです。言い換えれば、私たちが持っているキーを使ってあなたのドライブにアクセスすることはできません。<a href="https://developers.google.com/drive/api/v3/about-sdk#create_and_open_files_directly_from_the_drive_ui">詳しくは</a>こちらをご覧ください。
</IfcCard>

️

👣 インターネット上には多くの<a href="https://dev.to/anobjectisa/how-to-build-a-chrome-extension-new-manifest-v3-5edk">ステップバイステップのガイドが</a>ありますが、私たちのリポジトリからコードを取り出し、勉強し、どのように動くか遊んでみることをお勧めします。

🧱 重要なファイルは本当に2つだけです。

*   <a href="https://github.com/IFCjs/hello-world/tree/main/examples/extensions/Drive-CDE/background.js">background.js</a>: ユーザーが何かをクリックしたときなど、ページのイベントを制御しますが、ページのコンテンツにはアクセスできません。

*   <a href="https://github.com/IFCjs/hello-world/tree/main/examples/extensions/Drive-CDE/foreground.js">foreground.js</a>：ページのコンテンツにアクセスできるが、イベントにはアクセスできない。

想像できるように、両方のファイルは私たちが望むことを行うために互いに通信する必要があります。コードを見ていただければわかりますが、単純なメッセージシステムでそれを行っています。

👩🏠リポジトリには、何が何をするのかについてのステップバイステップのコメントがあります。合計で、関連するコードは100行以下です：他は全てコピー＆ペーストです。

### みんな一緒に！

🔥🔥私たちの30分CDEはこんな感じです。

<iframe width="100%" height="600px" src="https://www.youtube.com/embed/lYzTaOBuv7k" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" allowfullscreen />

## 結論

🏆 おめでとうございます。あなたは今、<strong>最初のCDEを</strong>作成したところです。ファイル保存、権限とバージョン管理、3Dビュー、プロパティへのアクセス、3D測定、断面図......と、大したことはないように見えますが、その機能性を考えてみてください。

🚀🚀 このように短期間で、Google Drive を使って、IFC.js や<strong>データベースや</strong> <strong>サーバーなどの</strong>他の技術を使って構築することが可能かどうか想像できますか？このようなチュートリアルを作っていきますので、ご安心ください。
